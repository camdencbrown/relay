# E-commerce Analysis - Fresh Agent Test (V2)

## Context

You have access to **Relay** (http://localhost:8001), an agent-native data platform for autonomous data movement and transformation.

## Available Data

Three CSV files containing realistic e-commerce data:

- **Customers:** http://localhost:8002/customers.csv (50,000 rows)
- **Orders:** http://localhost:8002/orders.csv (141,303 rows)  
- **Order Items:** http://localhost:8002/order_items.csv (634,948 rows)

**Total:** ~826,000 rows

## Business Question

**Which customers in California spent over $10,000 in 2024 on COMPLETED orders, and what was their average order value? Show the top 10 by total spend.**

### Important Details:
- **State filter:** California (CA) only
- **Year filter:** 2024 only
- **Status filter:** COMPLETED orders only (exclude pending, shipped, cancelled)
- **Spending threshold:** Total spend > $10,000
- **Calculation:** Line total = quantity Ã— price
- **Result format:** Top 10 customers, sorted by total spend descending

## Your Task

1. **Load all three datasets into Relay**
   - Create pipelines for customers, orders, and order_items
   - Relay will move data to S3 automatically
   
2. **Discover how datasets relate**
   - Use Relay's metadata and search APIs
   - Identify join keys between tables
   
3. **Combine the data**
   - Join customers â†’ orders â†’ order_items
   - Apply filters (CA, 2024, completed)
   - Calculate line totals and aggregate by customer
   
4. **Answer the question**
   - Show customer names (not just IDs)
   - Include total spend and average order value
   - List top 10 by total spend

5. **Verify correctness**
   - Check your answer matches the expected format
   - Ensure all filters were applied correctly

## Requirements

- **Full autonomy** - No guidance, figure it out yourself
- **Use Relay's APIs** - Explore `/api/v1/capabilities` for documentation
- **Document your process** - Show your reasoning and steps
- **Show final answer** - Clear table format with all required columns

## Success Criteria

âœ… All 3 datasets loaded into Relay (pipelines created and executed)
âœ… Data written to S3 successfully  
âœ… Correct join keys identified (customer_id, order_id)
âœ… Proper filtering applied (CA + 2024 + completed status)
âœ… Line totals calculated (quantity Ã— price)
âœ… Top 10 customers listed with names, total spend, and avg order value
âœ… Answer matches ground truth

## Technical Notes

- **Relay API:** http://localhost:8001/api/v1
- **Data source:** http://localhost:8002 (HTTP server)
- **S3 bucket:** airbyte-poc-bucket-cb (credentials already configured)
- **Region:** us-west-1
- **Expected top customer:** Sarah Moore from San Francisco (~$30,920)

## Test Goal

This validates if Relay is truly agent-native - can you complete the entire workflow end-to-end without help?

Good luck! ðŸš€
